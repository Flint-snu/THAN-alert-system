:root{
  --bg: radial-gradient(ellipse at center, #1a2947, #0b1320);
  --panel-bg: rgba(23, 35, 59, 0.6);
  --panel-border: rgba(47, 107, 255, 0.2);
  --panel-border-hover: rgba(47, 107, 255, 0.5);
  --text:#eef3ff;
  --muted:#a7b3d1;
  --primary:#2f6bff;
  --primary-glow: rgba(47, 107, 255, 0.4);
  --warning:#ffb020;
  --warning-glow: rgba(255, 176, 32, 0.3);
  --danger:#ff4d4f;
  --danger-glow: rgba(255, 77, 79, 0.3);
  --success:#3cc37a;
  --accent:#19b8ff;
  --radius:16px;
  --glass-bg: rgba(40, 40, 40, 0.5); 
  --glass-border: rgba(255, 255, 255, 0.2); 
  --glass-shadow: rgba(0, 0, 0, 0.4); 
  --shadow: 0 10px 30px rgba(0,0,0,.4);
}

/* === LIGHT THEME === */
body.light-theme {
  --bg: radial-gradient(ellipse at center, #f4f7fa, #e8ecf2);
  --panel-bg: rgba(255, 255, 255, 0.6);
  --panel-border: rgba(0, 0, 0, 0.1);
  --panel-border-hover: rgba(0, 0, 0, 0.2);
  --text: #1c202a;
  --muted: #5a647e;
  --primary-glow: rgba(47, 107, 255, 0.2);
  --warning-glow: rgba(255, 176, 32, 0.3);
  --danger-glow: rgba(255, 77, 79, 0.3);
  --glass-bg: rgba(255, 255, 255, 0.7); 
  --glass-border: rgba(0, 0, 0, 0.1); 
  --glass-shadow: rgba(0, 0, 0, 0.2); 
  --shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
}

.light-theme .switch {
  background: linear-gradient(145deg, #ffffff, #e6e9ef);
  border-top: 1px solid rgba(255, 255, 255, 0.9);
  border-left: 1px solid rgba(255, 255, 255, 0.8);
  border-bottom: 1px solid rgba(0, 0, 0, 0.1);
  border-right: 1px solid rgba(0, 0, 0, 0.1);
  box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
}
.light-theme .switch:active {
  background: linear-gradient(145deg, #e6e9ef, #ffffff);
  box-shadow: inset 0 2px 5px rgba(0, 0, 0, 0.15);
}
.light-theme .chip, .light-theme .btn, .light-theme .search input, .light-theme .card, .light-theme .ai-list li {
  background: rgba(230, 235, 245, 0.7);
  border-color: rgba(0, 0, 0, 0.1);
}
.light-theme .btn.ghost { background: transparent; }
.light-theme .btn.primary { background: var(--primary); color: #fff; }

.light-theme .stat {
  background: linear-gradient(145deg, rgba(235, 242, 255, 0.8), rgba(210, 225, 245, 0.8));
  border-top: 1px solid rgba(255, 255, 255, 0.9);
  border-left: 1px solid rgba(255, 255, 255, 0.8);
  border-bottom: 1px solid rgba(0, 0, 0, 0.1);
  border-right: 1px solid rgba(0, 0, 0, 0.1);
  box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
}
.light-theme .stat.warn { color: var(--danger); font-weight: 700; }
.light-theme .actions .btn { background: rgba(230, 235, 245, 0.7); border-color: rgba(0, 0, 0, 0.1); }
.light-theme .actions .btn.danger { background: rgba(255, 77, 79, 0.2); border-color: rgba(255, 77, 79, 0.3); }
.light-theme .actions .btn.safe { background: rgba(60, 195, 122, 0.2); border-color: rgba(60, 195, 122, 0.3); }

/* === GLOBAL LAYOUT === */
*{box-sizing:border-box}
html,body{height:100%}
body{
  margin:0;
  background: var(--bg);
  color:var(--text);
  font:500 16px/1.45 "Inter",system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;
  perspective: 2000px;
  overflow-y: auto;
}
a{color:var(--accent)}

.app{
  display:grid; grid-template-rows:auto auto 1fr auto; min-height:100vh; gap:12px; padding:16px;
  transform-style: preserve-3d;
}

.glass-panel {
  background: var(--panel-bg); backdrop-filter: blur(12px);
  border: 1px solid var(--panel-border); border-radius: var(--radius);
  box-shadow: var(--shadow); transition: all 0.3s ease-out; transform: translateZ(0);
}
.glass-panel:hover { transform: translateZ(20px) scale(1.01); border-color: var(--panel-border-hover); box-shadow: 0 15px 40px rgba(0,0,0,.5); }

header{
  display:flex;align-items:center;gap:12px;justify-content:space-between; padding:12px 16px;
  position: sticky; top: 16px; z-index: 100;
  background: var(--panel-bg); backdrop-filter: blur(12px);
  border: 1px solid var(--panel-border); border-radius: var(--radius); box-shadow: var(--shadow);
}
.brand{display:flex;align-items:center;gap:12px}
.logo{ width:36px;height:36px;border-radius:10px; background:radial-gradient(120% 120% at 30% 20%,#3aa1ff,#2146ff 40%,#111a2b 70%); box-shadow: 0 0 20px var(--primary-glow); }
.title{font-weight:800;letter-spacing:.2px}
.toolbar{display:flex;align-items:center;gap:8px}

.chip{
  background: rgba(14, 24, 48, 0.7); border: 1px solid rgba(34, 51, 87, 0.8);
  color:var(--muted); padding:8px 10px; border-radius:12px; font-size:13px;
}
.btn{
  cursor:pointer;border:none;border-radius:12px;padding:10px 14px;
  background: rgba(27, 40, 68, 0.8); color:var(--text);
  box-shadow: 0 4px 10px rgba(0,0,0,.2); border: 1px solid rgba(36, 53, 84, 0.7); transition: all 0.2s ease;
}
.btn:hover{ filter:brightness(1.08); border-color: var(--panel-border-hover); transform: translateY(-2px); }
.btn.primary{ background:var(--primary); box-shadow: 0 0 20px var(--primary-glow); }
.btn.ghost{background:transparent;border:1px solid #243554}

.search{position:relative}
.search input{
  width:280px; background:rgba(14, 24, 48, 0.7); color:var(--text);
  border:1px solid #1f2f51; border-radius:12px; padding:10px 36px 10px 12px;
}
.search .icon{position:absolute;right:10px;top:50%;transform:translateY(-50%);opacity:.7}

/* === ALERT STRIP === */
.alert-strip{
  display:flex;gap:16px;align-items:center;
  background: linear-gradient(90deg, rgba(59, 42, 0, 0.7), rgba(35, 20, 10, 0.7));
  backdrop-filter: blur(10px); border: 1px solid rgba(90, 60, 6, 0.8);
  box-shadow: 0 0 20px var(--warning-glow); color:#ffdca5; padding:10px 14px; border-radius:14px;
  transition: all 0.3s ease-out; transform: translateZ(0);
}
.alert-strip:hover { transform: translateZ(20px) scale(1.01); border-color: rgba(255, 176, 32, 0.5); box-shadow: 0 15px 40px rgba(0,0,0,.5); }
.alert-badge{
  display:inline-flex;align-items:center;gap:8px;padding:6px 10px;border-radius:10px;
  background:rgba(58, 43, 0, 0.8); color:#ffcf72; border:1px solid #6b4904; font-weight:700;
}
.countdown{margin-left:auto;font-variant-numeric:tabular-nums;color:#ffd28d}

.alert-strip.danger {
  background: linear-gradient(90deg, rgba(75, 12, 16, 0.7), rgba(42, 15, 19, 0.7));
  border-color: rgba(92, 27, 35, 0.8); box-shadow: 0 0 20px var(--danger-glow); color: #ffacac;
}
.alert-strip.danger .alert-badge { background: rgba(42, 15, 19, 0.8); border-color: #5c1b23; color: #ffacac; }
.alert-strip.danger .countdown { color: #ffc4c4; }

.alert-strip.success {
  background: linear-gradient(90deg, rgba(15, 36, 26, 0.7), rgba(15, 21, 42, 0.7));
  border-color: rgba(30, 80, 56, 0.8); box-shadow: 0 0 20px rgba(60, 195, 122, 0.3); color: #a5ffca;
}
.alert-strip.success .alert-badge { background: rgba(15, 36, 26, 0.8); border-color: #1e5038; color: #a5ffca; }
.alert-strip.success .countdown { color: #d2ffea; }

/* === MAIN LAYOUT === */
.main{
  display:grid;grid-template-columns:280px 1fr 340px;gap:12px;min-height:0;
  padding: 14px; background: var(--panel-bg); backdrop-filter: blur(12px);
  border: 1px solid var(--panel-border); border-radius: var(--radius); box-shadow: var(--shadow);
  transition: all 0.3s ease-out; transform: translateZ(0);
}
.main:hover { transform: translateZ(20px) scale(1.01); border-color: var(--panel-border-hover); box-shadow: 0 15px 40px rgba(0,0,0,.5); }

.panel{ background: transparent; border: none; box-shadow: none; padding: 0; min-height:0; }
.panel h3{margin:0 0 10px;font-size:15px;color:var(--muted);letter-spacing:.3px;padding-left:4px}
.layers{display:grid;gap:8px}

/* === SWITCHES === */
.switch{
  display:flex; align-items:center; justify-content:space-between;
  background: linear-gradient(145deg, rgba(30, 42, 70, 0.9), rgba(15, 23, 38, 0.9));
  padding:12px; border-radius:12px; cursor: pointer; transition: all 0.2s ease-out;
  border-top: 1px solid rgba(255, 255, 255, 0.15); border-left: 1px solid rgba(255, 255, 255, 0.1);
  border-bottom: 1px solid rgba(0, 0, 0, 0.3); border-right: 1px solid rgba(0, 0, 0, 0.3);
  box-shadow: 0 4px 10px rgba(0, 0, 0, 0.3);
}
.switch:hover { transform: translateY(-2px) scale(1.02); box-shadow: 0 8px 15px rgba(0, 0, 0, 0.4); border-top-color: rgba(255, 255, 255, 0.25); }
.switch input[type="checkbox"] {
  appearance: none; -webkit-appearance: none; width: 44px; height: 24px;
  background: rgba(0, 0, 0, 0.3); border: 1px solid rgba(0, 0, 0, 0.4); border-radius: 12px;
  cursor: pointer; position: relative; transition: all 0.3s ease; box-shadow: inset 0 1px 3px rgba(0,0,0,0.5); 
}
.switch input[type="checkbox"]::after {
  content: ''; position: absolute; width: 18px; height: 18px;
  background: linear-gradient(145deg, #e0e5ec, #ffffff); border-radius: 50%;
  top: 2px; left: 3px; box-shadow: 0 2px 4px rgba(0,0,0,0.4); transition: all 0.3s cubic-bezier(0.25, 0.8, 0.25, 1);
}
.switch input[type="checkbox"]:checked { background: var(--primary); border-color: rgba(47, 107, 255, 0.8); box-shadow: 0 0 10px var(--primary-glow); }
.switch input[type="checkbox"]:checked::after { transform: translateX(19px); background: #ffffff; }

/* === MAP & ANIMATIONS === */
.map-wrap{ position:relative;height:100%;min-height:420px;border-radius:12px;overflow:hidden; border:1px solid #1f2f51; }
#realMap { width: 100%; height: 100%; z-index: 1; }
.map-wrap { background: linear-gradient(170deg, #101a2e, #0a101c); box-shadow: inset 0 4px 15px rgba(0, 0, 0, 0.5); }
.light-theme .map-wrap { background: linear-gradient(170deg, #d4dde9, #e8eef5); box-shadow: inset 0 4px 15px rgba(0, 0, 0, 0.1); }

/* Wind & Wave Animations */
@keyframes wind-flow { from { stroke-dashoffset: 25; } to { stroke-dashoffset: 0; } }
#lyr-wind path { stroke-dasharray: 10 15; animation: wind-flow 1.5s linear infinite; }

@keyframes wave-scroll { 0% { transform: translateX(0px); } 100% { transform: translateX(-100px); } }
#lyr-wave { filter: drop-shadow(0 0 3px rgba(0, 180, 255, 0.7)) drop-shadow(0 0 6px rgba(0, 180, 255, 0.5)); animation: wave-scroll 4s linear infinite; }

@keyframes marching-ants { from { stroke-dashoffset: 12; } to { stroke-dashoffset: 0; } }
#lyr-track polyline { animation: marching-ants 1.5s linear infinite; }

@keyframes pulse-point { 0%, 100% { transform: scale(1); opacity: 1; } 50% { transform: scale(1.5); opacity: 0.5; } }
.forecast-points circle { animation: pulse-point 2.5s infinite ease-in-out; transform-origin: center; }

/* === CARDS & STATS === */
.cards{display:grid;gap:12px}
.card{ background: rgba(15, 23, 38, 0.7); border:1px solid rgba(34, 51, 87, 0.7); border-radius:14px; padding:12px; }
.stat{
  display:flex; align-items:center; justify-content:space-between; margin:6px 0; padding: 10px 12px; border-radius:10px;
  background: linear-gradient(145deg, rgba(30, 42, 70, 0.9), rgba(15, 23, 38, 0.9));
  border-top: 1px solid rgba(255, 255, 255, 0.1); border-left: 1px solid rgba(255, 255, 255, 0.08);
  border-bottom: 1px solid rgba(0, 0, 0, 0.3); border-right: 1px solid rgba(0, 0, 0, 0.3);
  box-shadow: 0 4px 10px rgba(0, 0, 0, 0.3); transition: all 0.2s ease-out;
}
.stat:hover { transform: translateY(-1px) scale(1.01); box-shadow: 0 6px 12px rgba(0, 0, 0, 0.4); }
.stat.warn{ box-shadow: 0 4px 10px rgba(0, 0, 0, 0.3), 0 0 8px var(--warning-glow); }
.ai-list{display:grid;gap:8px}
.ai-list li{ background:rgba(15, 26, 48, 0.7); border:1px solid rgba(33, 51, 87, 0.7); border-radius:10px; padding:8px 10px; }

/* === ACTIONS PANEL === */
.actions-panel {
  position: sticky; bottom: 16px; z-index: 100;
  background: var(--panel-bg); backdrop-filter: blur(12px);
  border: 1px solid var(--panel-border); border-radius: var(--radius);
  box-shadow: var(--shadow); padding: 14px; transition: all 0.3s ease-out; transform: translateZ(0);
}
.actions-panel:hover { transform: translateZ(20px) scale(1.01); border-color: var(--panel-border-hover); box-shadow: 0 15px 40px rgba(0,0,0,.5); }
.actions{display:grid;grid-template-columns:repeat(4,1fr);gap:12px;}
.actions .btn{
  display:flex;align-items:center;justify-content:center;gap:8px;padding:14px 10px;border-radius:14px;
  border:1px solid rgba(34, 51, 87, 0.7); background:rgba(15, 26, 48, 0.7); transition: all 0.3s ease;
}
.actions .btn:hover { transform: translateY(-5px); border-color: var(--panel-border-hover); }
.actions .btn.danger{ background:rgba(42, 15, 19, 0.7); border-color:rgba(92, 27, 35, 0.8); box-shadow: 0 0 15px var(--danger-glow); }
.actions .btn.safe{ background:rgba(15, 36, 26, 0.7); border-color:rgba(30, 80, 56, 0.8); }
.actions .btn.help{ background:rgba(15, 21, 42, 0.7); border-color:rgba(34, 51, 87, 0.8); }

/* === CUSTOM POPUPS & MARKERS === */
.leaflet-glass-popup .leaflet-popup-content-wrapper {
    background: var(--glass-bg); backdrop-filter: blur(16px) saturate(180%); -webkit-backdrop-filter: blur(16px) saturate(180%);
    border: 1px solid var(--glass-border); border-radius: 16px; box-shadow: 0 10px 30px var(--glass-shadow); padding: 1px; overflow: hidden;
}
.leaflet-glass-popup .leaflet-popup-content { padding-top: 22px; padding-bottom: 22px; margin: 0; width: auto !important; min-width: 180px; text-align: center; }
.leaflet-glass-popup .leaflet-popup-tip { background: var(--glass-bg); backdrop-filter: blur(16px); border: 1px solid var(--glass-border); }
.leaflet-glass-popup .leaflet-popup-close-button { color: var(--text-color); font-size: 20px; opacity: 0.7; }
.leaflet-glass-popup .leaflet-popup-close-button:hover { opacity: 1; color: var(--primary); }
.leaflet-glass-popup .info-box-title { color: var(--text-color-light); font-weight: 500; font-size: 0.9em; opacity: 0.8; display: block; margin-bottom: 4px; }
.leaflet-glass-popup .info-box-main { color: var(--primary); font-size: 2.5rem; font-weight: 800; line-height: 1; margin: 0; text-shadow: 0 0 8px rgba(var(--primary-rgb), 0.3); }
.leaflet-glass-popup .info-box-sub { color: var(--text-color-light); font-size: 0.85em; opacity: 0.8; margin-top: 10px; display: block; }
.leaflet-glass-popup .info-box-sub span { color: var(--success); }

.wind-vector-icon { width: 80px; height: 40px; pointer-events: none; border: none; background: none; }
.wind-vector-icon svg { width: 100%; height: 100%; overflow: visible; }
.wave-logo-icon { border-radius: 50% !important; border: 2px solid #00A8FF; box-shadow: 0 0 10px rgba(0, 168, 255, 0.7); background-color: #ffffff; }
.leaflet-wave-popup .leaflet-popup-content-wrapper {
    background: linear-gradient(rgba(0,0,0,0.4), rgba(0,0,0,0.4)), url('waterlogoBG.jpg'), var(--glass-bg);
    background-size: cover, 100% 100%, cover; background-position: center;
}
.leaflet-wave-popup .info-box-title { color: rgba(255, 255, 255, 0.7); }
.leaflet-wave-popup .info-box-main { color: #FFFFFF; text-shadow: 0 0 10px rgba(0, 168, 255, 0.7); }
.leaflet-wave-popup .leaflet-popup-close-button { color: #FFFFFF; }

.logo-img-header { width: 50px; height: 50px; border-radius: 50%; margin-right: 16px; object-fit: cover; border: 1px solid rgba(255, 255, 255, 0.15); }
#logo-light { display: none; }
.light-theme #logo-dark { display: none; }
.light-theme #logo-light { display: block; }

#theme.btn { padding: 0; width: 50px; height: 50px; border-radius: 60%; overflow: hidden; border: 1px solid var(--glass-border); }
.theme-icon { width: 100%; height: 100%; object-fit: cover; display: block; transform: scale(1.2); }

.road-event-label {
    background: rgba(13, 27, 42, 0.85); backdrop-filter: blur(5px);
    border: 1px solid rgba(255, 255, 255, 0.2); color: #FFFFFF; font-weight: 500;
    padding: 12px 14px; border-radius: 6px; box-shadow: 0 3px 8px rgba(0,0,0,0.4); border-left: 1px solid rgba(255, 255, 255, 0.2);
}
.road-event-label::after { content: ''; position: absolute; bottom: -10px; left: 50%; transform: translateX(-50%); width: 2px; height: 10px; background: #FFFFFF; }
.road-event-label.leaflet-tooltip-top:before { border: none !important; }

/* Detail Panel & Active State */
#detailPanel { display: flex; flex-direction: column; padding: 14px; }
.detail-header { display: flex; justify-content: space-between; align-items: center; border-bottom: 1px solid var(--panel-border); padding-bottom: 10px; margin-bottom: 10px; }
.detail-header h2 { margin: 0; font-size: 20px; font-weight: 700; color: var(--text); }
.detail-body { flex-grow: 1; display: flex; align-items: center; justify-content: center; width: 100%; }
.line-graph-svg { width: 100%; max-height: 300px; margin: auto; }

.side-left.detail-view-active .layers .switch { opacity: 0.3; pointer-events: none; transition: all 0.3s ease; }
.side-left.detail-view-active .layers .switch.active-layer {
  opacity: 1; pointer-events: auto; transform: translateY(-2px) scale(1.02);
  box-shadow: 0 8px 15px rgba(0, 0, 0, 0.4), 0 0 0 2px var(--primary); border-top-color: rgba(255, 255, 255, 0.25);
}
.light-theme .side-left.detail-view-active .layers .switch.active-layer { border-top-color: rgba(255, 255, 255, 0.9); }

/* Simulation Controls */
.sim-controls { display: flex; align-items: center; margin-left: 20px; background: rgba(14, 24, 48, 0.7); border: 1px solid rgba(34, 51, 87, 0.8); padding: 4px 8px; border-radius: 12px; }
.sim-controls .btn { padding: 6px 10px; font-size: 12px; font-weight: 700; border: 1px solid transparent; background: transparent; }
.sim-controls .btn.green { color: var(--success); }
.sim-controls .btn.orange { color: var(--warning); }
.sim-controls .btn.red { color: var(--danger); }
.sim-controls .btn:hover { background: rgba(255, 255, 255, 0.1); transform: translateY(0); }

/* Map Info Box */
.map-info-box-container { position: absolute; z-index: 10; display: flex; flex-direction: column; align-items: center; }
.map-info-box { background: #2a2a2e; color: var(--text); border-radius: 8px; padding: 10px 14px; box-shadow: 0 5px 15px rgba(0,0,0,0.4); min-width: 170px; border: 1px solid rgba(255, 255, 255, 0.1); }
.info-box-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 4px; }
.info-box-title { font-size: 13px; color: var(--muted); font-weight: 500; }
.info-box-close { background: none; border: none; color: var(--muted); font-size: 20px; cursor: pointer; padding: 0 0 0 10px; }
.info-box-main { font-size: 28px; font-weight: 800; color: var(--text); line-height: 1.2; }
.info-box-sub { font-size: 14px; color: var(--success); font-weight: 600; }
.info-box-line { width: 2px; height: 120px; background: #2a2a2e; }
.info-box-pin { width: 16px; height: 16px; background: #4a90e2; border-radius: 50%; border: 3px solid #ffffff; box-shadow: 0 0 10px rgba(74, 144, 226, 0.7); margin-top: -2px; }
.light-theme .map-info-box { background: #ffffff; border-color: rgba(0,0,0,0.1); box-shadow: 0 5px 15px rgba(0,0,0,0.15); }
.light-theme .info-box-line { background: #666; }
.light-theme .info-box-pin { border-color: #f0f0f0; }

@media (max-width:1100px){ .main{grid-template-columns:280px 1fr;} .panel.side-right{display:none} }
@media (max-width:720px){ .main{grid-template-columns:1fr;grid-template-rows:auto auto auto} .actions{grid-template-columns:1fr 1fr} .search input{width:180px} .panel.side-left{display:none} }